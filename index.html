<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å‹é”ãƒãƒ£ãƒƒãƒˆ</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDGPCCNoeWuPAhGpKLdabyAU-5hTdHemw8",
  authDomain: "my-chat-app-37b9e.firebaseapp.com",
  databaseURL: "https://my-chat-app-37b9e-default-rtdb.firebaseio.com",
  projectId: "my-chat-app-37b9e",
  storageBucket: "my-chat-app-37b9e.appspot.com",
  messagingSenderId: "111829020213",
  appId: "1:111829020213:web:44f631c678dcb8525c8b7c",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const messagesRef = ref(db, "messages");
const chat = document.getElementById("chat");
const textInput = document.getElementById("text");
const sendBtn = document.getElementById("send");
const nameInput = document.getElementById("name");
const stampBtns = document.querySelectorAll(".stamp-btn");

// ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å—ä¿¡
onValue(messagesRef, (snapshot) => {
  chat.innerHTML = "";
  const data = snapshot.val();
  if(data){
    Object.values(data).forEach(msg => {
      const div = document.createElement("div");
      div.className = "message";
      if(msg.stamp){
        div.innerHTML = `<strong>${msg.user || 'åç„¡ã—'}:</strong> <br>
                         <img src="${msg.stamp}" style="width:50px;">`;
      } else {
        div.textContent = `${msg.user || 'åç„¡ã—'}: ${msg.text}`;
      }
      chat.appendChild(div);
    });
    chat.scrollTop = chat.scrollHeight;
  }
});

// ãƒ†ã‚­ã‚¹ãƒˆé€ä¿¡
sendBtn.addEventListener("click", async () => {
  const user = nameInput.value.trim() || 'åç„¡ã—';
  const text = textInput.value.trim();
  if(text){
    await push(messagesRef, { text, user, time: Date.now() });
    textInput.value = "";
  }
});

// ã‚¹ã‚¿ãƒ³ãƒ—é€ä¿¡
stampBtns.forEach(btn => {
  btn.addEventListener("click", async () => {
    const user = nameInput.value.trim() || 'åç„¡ã—';
    const url = btn.dataset.url;
    await push(messagesRef, { stamp: url, user, time: Date.now() });
  });
});
</script>

<style>
body {
  font-family: sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: #f6f6f6;
  height: 100vh;
  margin: 0;
}
#chat {
  flex: 1;
  width: 90%;
  max-width: 500px;
  background: white;
  border-radius: 20px;
  margin-top: 20px;
  padding: 10px;
  overflow-y: auto;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
#input {
  display: flex;
  width: 90%;
  max-width: 500px;
  margin: 10px;
}
#name {
  width: 100px;
  margin-right: 5px;
  border-radius: 10px;
  padding: 5px;
}
#text {
  flex: 1;
  border: 1px solid #ccc;
  border-radius: 10px;
  padding: 5px;
}
#send {
  margin-left: 5px;
  background: #007aff;
  color: white;
  border: none;
  border-radius: 10px;
  padding: 5px 10px;
  cursor: pointer;
}
.message {
  margin-bottom: 10px;
}
.stamp-btn {
  cursor: pointer;
  margin: 5px;
  width: 50px;
}
</style>
</head>
<body>
<h2>ğŸ’¬ å‹é”ãƒãƒ£ãƒƒãƒˆ</h2>
<div id="chat"></div>
<div id="input">
  <input id="name" placeholder="åå‰"/>
  <input id="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." />
  <button id="send">é€ä¿¡</button>
</div>

<h3>ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆã„ã‚‰ã™ã¨ã‚„ï¼‰</h3>
<div id="stamps">
  <img class="stamp-btn" src="https://www.irasutoya.com/wp-content/uploads/2022/03/face_smile.png" data-url="https://www.irasutoya.com/wp-content/uploads/2022/03/face_smile.png">
  <img class="stamp-btn" src="https://www.irasutoya.com/wp-content/uploads/2021/12/heart.png" data-url="https://www.irasutoya.com/wp-content/uploads/2021/12/heart.png">
  <img class="stamp-btn" src="https://www.irasutoya.com/wp-content/uploads/2020/05/thumb_up.png" data-url="https://www.irasutoya.com/wp-content/uploads/2020/05/thumb_up.png">
</div>
</body>
</html>
