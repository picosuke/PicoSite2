<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>友達チャット</title>
<script type="module" src="script.js"></script>
<link rel="stylesheet" href="./style.css">
</head>
<body>
<header id="hd">
  <div class="menu-toggle">
    <span></span>
    <span></span>
    <span></span>
  </div>
  <ul>
    <li data-target="main1">ホーム</li>
    <li data-target="main2">チャット</li>
    <li data-target="main3">chatGPT</li>
    <li data-target="main4">PicoTube</li>
    <li data-target="main5">学習ゲーム</li>
  </ul>
</header>

<!-- 各メインコンテンツ -->
<main id="main1" class="content active">
  <!-- ホーム画面 -->
<div id="home-section" class="home">
  <div class="hero">
    <h2>ようこそ、PicoSite2へ</h2>
    <p>PicoSiteを越えた滑らかで直感的なデザイン。<br>
      シンプルな操作と美しいUIを体験してみてください。</p>
    <button id="getStartedBtn">はじめる →</button>
  </div>

  <div class="feature-grid">
    <div class="feature">
      <h4>軽量で高速</h4>
      <p>必要最小限の構成で素早くロード。</p>
    </div>
    <div class="feature">
      <h4>滑らかなUI</h4>
      <p>近未来のようなやわらかいアニメーション。</p>
    </div>
    <div class="feature">
      <h4>学習に役立てる</h4>
      <p>勉強できる便利なサイト</p>
    </div>
  </div>
</div>

</main>

<main id="main2" class="content">
  <span>チャット</span>
  <div id="chat"></div>
  <div id="input">
    <input id="name" placeholder="名前"/>
    <input id="text" placeholder="メッセージを入力..." />
    <button id="send">送信</button>
  </div>

  <h3>スタンプ（いらすとや）</h3>
  <div id="stamps">
    <img class="stamp-btn" src="https://x.gd/VJFXa" data-url="https://x.gd/VJFXa">
    <img class="stamp-btn" src="https://x.gd/Pq0J5" data-url="https://x.gd/Pq0J5">
    <img class="stamp-btn" src="https://x.gd/ojvnt" data-url="https://x.gd/ojvnt">
  </div>
</main>
  
<main id="main3" class="content">
  <div class="chat-card">
    <h2>💬 ChatGPT チャット</h2>
    <p class="desc">ChatGPTと会話してみましょう。HTMLコードも安全に表示されます。</p>

    <div id="chat-box"></div>

    <textarea id="chat-input" placeholder="メッセージを入力（Shift+Enterで改行）..."></textarea>
    <button id="chat-send">送信</button>
  </div>
</main>
  
<main id="main4" class="content">
  PicoTube
</main>
  
<main id="main5" class="content">
<h1>⚔️ 刹那の見切り ⚔️</h1>
<p>出された問題を誰よりも早く正解せよ！<br>Enterで解答。コンピューターが先に答えたら負け！</p>

<select id="difficulty">
  <option value="easy">EASY（遅い）</option>
  <option value="normal" selected>NORMAL</option>
  <option value="hard">HARD（速い）</option>
</select>

<canvas id="battle" width="500" height="300"></canvas>

<script>
const canvas = document.getElementById("battle");
const ctx = canvas.getContext("2d");
const difficulty = document.getElementById("difficulty");

let playerInput = "";
let question = "";
let correctAnswer = 0;
let playerWin = null; // true=勝ち false=負け null=進行中
let cpuTime = 0;
let cpuTimer = null;
let started = false;

// 難易度ごとのCPU反応速度（ms）
const cpuSpeed = {
  easy: [1800, 2500],
  normal: [900, 1500],
  hard: [400, 800]
};

// 新しい問題を作る
function newQuestion() {
  const a = Math.floor(Math.random() * 9) + 1;
  const b = Math.floor(Math.random() * 20) + 2; // 割られる方（2桁OK）
  const op = Math.random() < 0.5 ? "×" : "÷";

  if (op === "×") {
    question = `${a} × ${b}`;
    correctAnswer = a * b;
  } else {
    // 割り切れるようにする
    const ans = a;
    const div = b;
    question = `${a * b} ÷ ${b}`;
    correctAnswer = ans;
  }

  playerInput = "";
  playerWin = null;
  started = true;

  // CPUタイマー設定
  const [min, max] = cpuSpeed[difficulty.value];
  const delay = Math.floor(Math.random() * (max - min) + min);
  clearTimeout(cpuTimer);
  cpuTimer = setTimeout(cpuAnswer, delay);
}

// CPUが答える
function cpuAnswer() {
  if (!started) return;
  playerWin = false; // プレイヤー負け
  started = false;
}

// プレイヤーが答える
document.addEventListener("keydown", (e) => {
  if (e.key >= "0" && e.key <= "9") {
    playerInput += e.key;
  } else if (e.key === "Backspace") {
    playerInput = playerInput.slice(0, -1);
  } else if (e.key === "Enter") {
    if (!started) {
      newQuestion();
      return;
    }
    if (parseInt(playerInput) === correctAnswer) {
      playerWin = true;
      started = false;
      clearTimeout(cpuTimer);
    }
  }
});

// 描画
function drawCharacter(x, y, color, face) {
  ctx.fillStyle = color;
  ctx.beginPath();
  ctx.arc(x, y, 30, 0, Math.PI * 2);
  ctx.fill();
  ctx.fillStyle = "#fff";
  ctx.font = "20px sans-serif";
  ctx.textAlign = "center";
  ctx.fillText(face, x, y + 7);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // キャラ描画
  drawCharacter(120, 150, "#4CAF50", "😎"); // プレイヤー
  drawCharacter(380, 150, "#E53935", "🤖"); // コンピューター

  // 問題
  ctx.fillStyle = "#fff";
  ctx.font = "26px sans-serif";
  ctx.textAlign = "center";
  ctx.fillText(`問題: ${question}`, 250, 60);

  // プレイヤー入力
  ctx.font = "22px monospace";
  ctx.fillText(`あなたの答え: ${playerInput}`, 250, 240);

  // 結果
  if (playerWin === true) {
    ctx.fillStyle = "yellow";
    ctx.font = "28px bold sans-serif";
    ctx.fillText("🎉 勝ち！", 250, 100);
  } else if (playerWin === false) {
    ctx.fillStyle = "red";
    ctx.font = "28px bold sans-serif";
    ctx.fillText("💀 負け...", 250, 100);
  } else if (!started) {
    ctx.font = "18px sans-serif";
    ctx.fillText("Enterで開始！", 250, 100);
  }

  requestAnimationFrame(draw);
}

draw();
</script>
</main>
</body>
</html>
